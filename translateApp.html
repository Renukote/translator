<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #container {
            display: flex;
            width: 800px;
            background-color: white;
            margin: 20px 0px;
        }

        #container>div {
            /* border: 1px solid teal; */
            width: 400px;
            height: 200px;
            vertical-align: text-top;
            font-size: 20px;
        }

        #container textarea {
            width: 100%;
            height: 90%;
        }

        #buttons {
            margin: 20px 0px;
        }

        #buttons>button {
            margin: 0px 20px;
            width: fit-content;
            padding: 10px;
            background-color: grey
        }
    </style>
</head>

<body>





    <div id="container">

        <!-- source -->
        <div>
            <div>
                <div>
                    <label for="srcLang">Translate from</label>
                    <select id="srcLang" name="srcLang">
                        <option value="en">English</option>
                        <option value="ar">Arabic</option>
                        <option value="zh">Chinese</option>
                        <option value="fr">French</option>
                        <option value="de">German</option>
                        <option value="hi">Hindi</option>
                        <option value="id">Indonesian</option>
                        <option value="ga">Irish</option>
                        <option value="it">Italian</option>
                        <option value="ja">Japanese</option>
                        <option value="ko">Korean</option>
                        <option value="pl">Polish</option>
                        <option value="pt">Portuguese</option>
                        <option value="ru">Russian</option>
                        <option value="es">Spanish</option>
                        <option value="tr">Turkish</option>
                        <option value="vi">Vietnamese</option>
                    </select>
                </div>

            </div>

            <textarea name="" id="from" cols="30" rows="10"></textarea>
        </div>


        <!-- target -->
        <div>
            <div>
                <label for="tarLang">Translate into </label>
                <select id="tarLang" name="tarLang">
                    <option value="en">English</option>
                    <option value="ar">Arabic</option>
                    <option value="zh">Chinese</option>
                    <option value="fr">French</option>
                    <option value="de">German</option>
                    <option value="hi">Hindi</option>
                    <option value="id">Indonesian</option>
                    <option value="ga">Irish</option>
                    <option value="it">Italian</option>
                    <option value="ja">Japanese</option>
                    <option value="ko">Korean</option>
                    <option value="pl">Polish</option>
                    <option value="pt">Portuguese</option>
                    <option value="ru">Russian</option>
                    <option value="es">Spanish</option>
                    <option value="tr">Turkish</option>
                    <option value="vi">Vietnamese</option>
                </select>
            </div>

            <textarea name="" id="to" cols="30" rows="10"></textarea>
        </div>
    </div>

    <div id="buttons">
        <button onclick="speechToText()">Tap to Speak</button>
        <button onclick='tran()'>Translate</button>
        <button onclick='textToAudio()'>Speak out</button>
    </div>

</body>

</html>

<script>
    // https://libretranslate.de/translate&q=hello&source=en&target=hi&format=text&api_key=xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx

    async function tran() {
        let targetLang = document.getElementById('tarLang').value;
        console.log('tarLang', targetLang);

        let srcLang = document.getElementById('srcLang').value;
        console.log('srcLang', srcLang);

        let query = document.getElementById('from').value;
        console.log(query);

        const res = await fetch("https://libretranslate.de/translate", {
            method: "POST",
            body: JSON.stringify({
                q: query,
                source: "en",
                target: targetLang
            }),
            headers: { "Content-Type": "application/json" }
        });

        let out = await res.json();
        console.log(out);

        let output = document.getElementById('to');
        output.value = out.translatedText;
    }
</script>


<script>
    /*
    async function detectLang() {
  const res = await fetch("https://libretranslate.de/detect", {
    method: "POST",
    body: JSON.stringify({
      q: "hola",
      source: "en",
      target: "es",
    }),
    headers: { "Content-Type": "application/json" },
  });

  console.log(await res.json());
  */
</script>

<script>
    function textToAudio() {
        let targetLang = document.getElementById('tarLang').value;
        console.log('tarLang', targetLang);

        let msg = document.getElementById("to").value;
        let speech = new SpeechSynthesisUtterance();
        speech.lang = targetLang;
        speech.text = msg;
        speech.volume = 2;
        speech.rate = 1;
        speech.pitch = 1;

        window.speechSynthesis.speak(speech);
    }
</script>

<script>

    async function speechToText() {

        // new speech recognition object
        var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;
        var recognition = new SpeechRecognition();

        // This runs when the speech recognition service starts
        recognition.onstart = function () {
            console.log("We are listening. Try speaking into the microphone.");
        };

        recognition.onspeechend = function () {
            // when user is done speaking
            recognition.stop();
        }

        // This runs when the speech recognition service returns result
        recognition.onresult = function (event) {
            var transcript = event.results[0][0].transcript;
            var confidence = event.results[0][0].confidence;

            console.log( transcript, confidence );

            let from = document.getElementById('from');
            from.innerHTML = "";
            from.value = transcript;
        };

        await recognition.start();

    }
</script>